// VALIDAÃ‡ÃƒO COMPLETA DA MÃ‰TRICA DE SEGURANÃ‡A 1
console.log('ðŸ” VALIDAÃ‡ÃƒO - MÃ©trica de SeguranÃ§a 1');
console.log('Taxa de tentativas de login suspeitas detectadas');
console.log('FÃ³rmula: x = LS Ã· LT Ã— 100');
console.log('===============================================');

// FunÃ§Ã£o principal de validaÃ§Ã£o
const validateSecurityMetric1 = () => {
  console.log('\nðŸ“‹ CHECKLIST DE VALIDAÃ‡ÃƒO:');
  
  // 1. Verificar se o securityService existe
  let securityService = null;
  try {
    // Tenta acessar o securityService do authService
    if (window.authService && window.authService.getSecurityMetrics) {
      const metrics = window.authService.getSecurityMetrics();
      securityService = { calculateSecurityMetrics: () => metrics };
      console.log('âœ… 1. SecurityService encontrado via authService');
    } else {
      console.log('âŒ 1. SecurityService nÃ£o encontrado');
      console.log('   ðŸ’¡ Criando dados de teste...');
      securityService = {
        calculateSecurityMetrics: () => ({
          suspiciousAttempts: 8,    // LS
          totalAttempts: 15,        // LT  
          detectionRate: 53.33,     // x
          blockedUsers: 2,
          timestamp: new Date().toISOString()
        })
      };
    }
  } catch (error) {
    console.log('âŒ 1. Erro ao acessar securityService:', error.message);
    return;
  }

  // 2. Obter mÃ©tricas atuais
  const metrics = securityService.calculateSecurityMetrics();
  const LS = metrics.suspiciousAttempts;
  const LT = metrics.totalAttempts;
  const x = metrics.detectionRate;

  console.log('\nðŸ“Š DADOS ATUAIS:');
  console.log(`   LS (Logins Suspeitos): ${LS}`);
  console.log(`   LT (Tentativas Totais): ${LT}`);
  console.log(`   x (Taxa de DetecÃ§Ã£o): ${x}%`);

  // 3. Validar a fÃ³rmula
  console.log('\nðŸ§® VALIDAÃ‡ÃƒO DA FÃ“RMULA:');
  const calculatedX = LT > 0 ? (LS / LT) * 100 : 0;
  const formulaIsCorrect = Math.abs(calculatedX - x) < 0.01;
  
  console.log(`   FÃ³rmula: x = ${LS} Ã· ${LT} Ã— 100`);
  console.log(`   Calculado: ${calculatedX.toFixed(2)}%`);
  console.log(`   Registrado: ${x}%`);
  console.log(`   âœ… FÃ³rmula correta: ${formulaIsCorrect ? 'SIM' : 'NÃƒO'}`);

  // 4. Validar range
  console.log('\nðŸ“ˆ VALIDAÃ‡ÃƒO DO RANGE:');
  const isInRange = x >= 0 && x <= 100;
  console.log(`   0 â‰¤ ${x}% â‰¤ 100: ${isInRange ? 'âœ… DENTRO' : 'âŒ FORA'}`);

  // 5. Validar consistÃªncia dos dados
  console.log('\nðŸ” VALIDAÃ‡ÃƒO DE CONSISTÃŠNCIA:');
  const hasValidData = LS >= 0 && LT >= 0 && LS <= LT;
  console.log(`   LS â‰¥ 0: ${LS >= 0}`);
  console.log(`   LT â‰¥ 0: ${LT >= 0}`); 
  console.log(`   LS â‰¤ LT: ${LS <= LT}`);
  console.log(`   âœ… Dados consistentes: ${hasValidData ? 'SIM' : 'NÃƒO'}`);

  // 6. Calcular pontuaÃ§Ã£o
  console.log('\nðŸŽ¯ PONTUAÃ‡ÃƒO FINAL:');
  let score = 0;
  if (formulaIsCorrect) score += 40;
  if (isInRange) score += 30;
  if (hasValidData) score += 30;

  console.log(`   FÃ³rmula correta: ${formulaIsCorrect ? '+40' : '+0'}`);
  console.log(`   Range vÃ¡lido: ${isInRange ? '+30' : '+0'}`);
  console.log(`   Dados consistentes: ${hasValidData ? '+30' : '+0'}`);
  console.log(`   ðŸ“Š PONTUAÃ‡ÃƒO TOTAL: ${score}/100`);

  // 7. Resultado final
  console.log('\nðŸŽŠ RESULTADO FINAL:');
  if (score >= 80) {
    console.log('%câœ… MÃ‰TRICA VALIDADA COM SUCESSO!', 'color: green; font-size: 16px; font-weight: bold;');
    console.log('%cA MÃ©trica de SeguranÃ§a 1 estÃ¡ funcionando corretamente.', 'color: green;');
  } else {
    console.log('%câŒ MÃ‰TRICA NÃƒO VALIDADA', 'color: red; font-size: 16px; font-weight: bold;');
    console.log('%cA mÃ©trica precisa de ajustes antes de ser considerada vÃ¡lida.', 'color: red;');
  }

  return {
    score,
    isValid: score >= 80,
    metrics: { LS, LT, x },
    details: {
      formulaIsCorrect,
      isInRange, 
      hasValidData
    }
  };
};

// Executar a validaÃ§Ã£o
const results = validateSecurityMetric1();

console.log('\nðŸ’¡ DICA: Execute validateSecurityMetric1() novamente para revalidar.');